- name: Update PiKVM Certificate
  hosts: "kvm"
  remote_user: root
  become: yes
  tasks:
    - name: read-write access
      shell:
        cmd: rw
    - name: Copy certificate
      copy:
        src: ../files/certificate/certificate.crt
        dest: /etc/kvmd/nginx/ssl/server.crt
        owner: root
        group: root
        mode: u+rw,g-wx,o-wx
    - name: Copy certificate key
      copy:
        src: ../files/certificate/certificate.key
        dest: /etc/kvmd/nginx/ssl/server.key
        owner: root
        group: root
        mode: u+rw,g-wx,o-wx
    - name: read-only access
      shell:
        cmd: ro
    - name: restart nginx
      shell:
        cmd: systemctl restart kvmd-nginx
