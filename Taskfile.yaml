---
version: "3"

vars:
  KUBERNETES_DIR: "{{.ROOT_DIR}}/kubernetes"

# env:
#   KUBECONFIG: "./kubernetes/main/kubeconfig:./kubernetes/staging/kubeconfig:./kubernetes/nas/kubeconfig"

includes:
  bootstrap: .taskfiles/Bootstrap/Taskfile.yaml
  proxmox: .taskfiles/Proxmox/Taskfile.yaml
  talos: .taskfiles/Talos/Taskfile.yaml

  es:
    taskfile: .taskfiles/secrets
  fmt:
    taskfile: .taskfiles/format
  fx:
    taskfile: .taskfiles/flux
  kub:
    taskfile: .taskfiles/kubernetes
  pc:
    taskfile: .taskfiles/pre-commit
  pg:
    taskfile: .taskfiles/postgres
  redis:
    taskfile: .taskfiles/redis
  rook:
    taskfile: .taskfiles/rook
  sops:
    taskfile: .taskfiles/sops
  vs:
    taskfile: .taskfiles/volsync

tasks:
  secrets:
    desc: Encode config and secrets
    cmds:
      - |
        infrastructure/setup/build-config.sh

  default:
    silent: true
    cmds:
      - task -l
